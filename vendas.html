<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel LevelUp3D - Vendas</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Audiowide&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --bg-dark: #12121E;
            --bg-main: #1A1A2E;
            --bg-sidebar: #161625;
            --text-light: #F0F0F0;
            --text-muted: #A0A0A0;
            --accent-cyan: #44CFCB;
            --accent-purple: #8A2BE2;
            --accent-gold: #FFD700;
            --status-pending: #555B69;
            --status-completed: var(--accent-cyan);
            --danger: #ff4d4d;
        }

        html { box-sizing: border-box; }
        *, *:before, *:after { box-sizing: inherit; }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Layout Principal --- */
        .sidebar {
            width: 280px;
            background-color: var(--bg-sidebar);
            border-right: 1px solid rgba(138, 43, 226, 0.3);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
            z-index: 1;
        }

        .main-content {
            flex-grow: 1;
            padding: 2rem 3rem;
            overflow-y: auto;
            z-index: 1;
        }

        .logo h1 {
            font-family: 'Audiowide', cursive;
            color: var(--accent-cyan);
            text-shadow: 0 0 10px rgba(68, 207, 203, 0.5);
            margin: 0;
            font-size: 1.8rem;
            text-align: center;
        }
        .logo h1 i { margin-right: 10px; }

        .dashboard h2, .backup h2 {
            font-size: 1.2rem; color: var(--text-muted); border-bottom: 1px solid var(--accent-purple);
            padding-bottom: 0.5rem; margin-bottom: 1.5rem;
        }

        .metric { text-align: center; margin-bottom: 1.5rem; }
        .metric h3 { margin: 0 0 0.5rem 0; font-size: 1rem; color: var(--text-light); }
        .metric p { margin: 0; font-size: 2rem; font-weight: 600; color: var(--accent-gold); transition: color 0.3s ease; }

        .backup-actions button, .backup-actions label {
            display: block; width: 100%; padding: 0.8rem; margin-bottom: 1rem; border: 1px solid var(--accent-purple);
            border-radius: 8px; background-color: transparent; color: var(--accent-cyan);
            font-weight: 500; cursor: pointer; text-align: center; transition: background-color 0.3s, color 0.3s;
        }
        .backup-actions button:hover, .backup-actions label:hover { background-color: var(--accent-purple); color: white; }
        #import-csv-input { display: none; }

        /* --- Conteúdo Principal --- */
        .page-header h1 { font-size: 2.5rem; margin-bottom: 2rem; }

        section {
            background-color: var(--bg-main);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 1px solid rgba(138, 43, 226, 0.2);
        }

        h2 { font-family: 'Audiowide', cursive; color: var(--accent-cyan); }
        
        #sale-form { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 0.5rem; font-weight: 500; }
        input, select, button {
            padding: 0.8rem; border-radius: 8px; border: 1px solid var(--accent-purple);
            background-color: var(--bg-dark); color: var(--text-light); font-size: 1rem;
        }
        .form-group-full { grid-column: 1 / -1; }
        .submit-btn {
            background: linear-gradient(45deg, var(--accent-purple), var(--accent-cyan)); font-weight: 600;
            cursor: pointer; transition: transform 0.3s, filter 0.3s;
        }
        .submit-btn:hover { transform: translateY(-3px); filter: brightness(1.2); }

        .sales-header { display: flex; justify-content: space-between; align-items: center; }
        .filter-buttons button {
            background: transparent; border: 1px solid var(--accent-purple);
            color: var(--text-muted); padding: 0.5rem 1rem; margin-left: 0.5rem;
            border-radius: 8px; cursor: pointer; transition: background-color 0.3s, color 0.3s;
        }
        .filter-buttons button.active { background-color: var(--accent-purple); color: white; }

        .sales-table-wrapper { overflow-x: auto; margin-top: 1.5rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid #2A2A4E; }
        th { color: var(--accent-cyan); }
        td { color: var(--text-muted); }
        td.actions { text-align: center; }
        .status-icon, .delete-btn {
            background: none; border: none; cursor: pointer; font-size: 1.3rem;
            transition: color 0.3s, text-shadow 0.3s, transform 0.2s;
        }
        .status-icon:hover, .delete-btn:hover { transform: scale(1.2); }
        .status-icon.pending { color: var(--status-pending); }
        .status-icon.completed { color: var(--status-completed); text-shadow: 0 0 8px var(--status-completed); }
        .delete-btn { color: var(--danger); }

        /* Estilos para os Gráficos */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 2rem;
            align-items: center;
        }
        .chart-container { max-width: 400px; margin: 2rem auto 0 auto; }
        .bar-chart-container { margin-top: 2rem; }
        
        /* Botões de Toggle para o Gráfico de Barras */
        .chart-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .chart-toggle button {
            background: transparent; border: 1px solid var(--accent-purple);
            color: var(--text-muted); padding: 0.5rem 1rem; border-radius: 8px;
            cursor: pointer; transition: background-color 0.3s, color 0.3s;
        }
        .chart-toggle button.active { background-color: var(--accent-purple); color: white; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .new-sale-row { animation: fadeIn 0.5s ease-out; }

        @media (max-width: 1200px) {
            .charts-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 900px) {
            body { flex-direction: column; height: auto; overflow: auto; }
            .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid rgba(138, 43, 226, 0.3); }
            .main-content { padding: 1.5rem; }
            #sale-form { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo"><h1><i class="fas fa-rocket"></i> LevelUp3D</h1></div>
        <div class="dashboard">
            <h2><i class="fas fa-chart-pie"></i> Dashboard</h2>
            <div class="metric">
                <h3>Vendas Totais</h3>
                <p id="total-sales">0</p>
            </div>
            <div class="metric">
                <h3>Faturamento Total</h3>
                <p id="total-revenue">R$ 0,00</p>
            </div>
        </div>
        <div class="backup">
            <h2><i class="fas fa-database"></i> Backup & Restauração</h2>
            <div class="backup-actions">
                <button id="export-csv-btn"><i class="fas fa-file-export"></i> Exportar para CSV</button>
                <label for="import-csv-input"><i class="fas fa-file-import"></i> Importar de CSV</label>
                <input type="file" id="import-csv-input" accept=".csv">
            </div>
        </div>
    </aside>

    <main class="main-content">
        <section>
            <h2><i class="fas fa-plus-circle"></i> Registrar Nova Venda</h2>
            <form id="sale-form">
                <div class="form-group"><label for="product">Produto</label><select id="product" required><option value="Caixa Misteriosa">Caixa Misteriosa</option><option value="Chaveiro Geek">Chaveiro Geek</option><option value="Produto Personalizado">Produto Personalizado</option><option value="Outro">Outro</option></select></div>
                <div class="form-group"><label for="quantity">Quantidade</label><input type="number" id="quantity" value="1" min="1" required></div>
                <div class="form-group"><label for="price">Preço Unitário (R$)</label><input type="number" id="price" step="0.01" min="0" required></div>
                <div class="form-group"><label for="customer">Cliente</label><input type="text" id="customer" placeholder="Opcional"></div>
                <div class="form-group"><label for="payment-method">Pagamento</label><select id="payment-method" required><option value="Pix">Pix</option><option value="Dinheiro">Dinheiro</option><option value="Cartão">Cartão</option></select></div>
                <div class="form-group-full"><button type="submit" class="submit-btn">Adicionar Venda</button></div>
            </form>
        </section>

        <section>
            <div class="sales-header">
                <h2><i class="fas fa-list-ul"></i> Vendas Registradas</h2>
                <div class="filter-buttons">
                    <button class="active" data-filter="all">Ver Todos</button>
                    <button data-filter="pending">Pendentes</button>
                    <button data-filter="completed">Concluídos</button>
                </div>
            </div>
            <div class="sales-table-wrapper">
                <table id="sales-table">
                    <thead>
                        <tr><th>Data</th><th>Produto</th><th>Total</th><th>Cliente</th><th style="text-align:center;">Pago</th><th style="text-align:center;">Entregue</th><th style="text-align:center;">Ações</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
        
        <section>
            <h2><i class="fas fa-chart-bar"></i> Análise de Vendas</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                </div>
                <div class="bar-chart-container">
                    <div class="chart-toggle">
                        <button data-metric="count" class="active">Nº de Vendas</button>
                        <button data-metric="revenue">Faturamento</button>
                    </div>
                    <canvas id="dailySalesChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos da UI
            const saleForm = document.getElementById('sale-form');
            const salesTableBody = document.querySelector('#sales-table tbody');
            const totalSalesEl = document.getElementById('total-sales');
            const totalRevenueEl = document.getElementById('total-revenue');
            const filterButtons = document.querySelectorAll('.filter-buttons button');
            const exportBtn = document.getElementById('export-csv-btn');
            const importInput = document.getElementById('import-csv-input');
            const doughnutChartCanvas = document.getElementById('salesChart');
            const barChartCanvas = document.getElementById('dailySalesChart');
            const chartToggleButtons = document.querySelectorAll('.chart-toggle button');
            
            // Estado da aplicação
            let sales = JSON.parse(localStorage.getItem('sales')) || [];
            let currentFilter = 'all';
            let dailyChartMetric = 'count'; // 'count' ou 'revenue'
            let salesDoughnutChart, salesBarChart;

            // --- FUNÇÕES PRINCIPAIS ---

            const saveData = () => localStorage.setItem('sales', JSON.stringify(sales));
            
            const refreshUI = (isNewSale = false) => {
                const lastRowToAnimate = isNewSale ? sales[sales.length - 1]?.id : null;
                renderSales(lastRowToAnimate);
                updateDashboard();
                updateDoughnutChart();
                updateDailySalesChart();
            };

            const renderSales = (newSaleId = null) => {
                salesTableBody.innerHTML = '';
                const filteredSales = sales.filter(sale => {
                    if (currentFilter === 'pending') return !sale.isPaid || !sale.isDelivered;
                    if (currentFilter === 'completed') return sale.isPaid && sale.isDelivered;
                    return true;
                }).sort((a, b) => b.id - a.id);

                if (filteredSales.length === 0) {
                    salesTableBody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Nenhuma venda encontrada.</td></tr>';
                } else {
                    filteredSales.forEach(sale => {
                        const total = sale.quantity * sale.price;
                        const row = document.createElement('tr');
                        row.dataset.id = sale.id;
                        if (sale.id === newSaleId) row.classList.add('new-sale-row');
                        row.innerHTML = `
                            <td>${new Date(sale.id).toLocaleDateString('pt-BR')}</td><td>${sale.product}</td>
                            <td>${total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td><td>${sale.customer || 'N/A'}</td>
                            <td style="text-align:center;"><button class="status-icon ${sale.isPaid ? 'completed' : 'pending'}" data-status="isPaid"><i class="fas fa-dollar-sign"></i></button></td>
                            <td style="text-align:center;"><button class="status-icon ${sale.isDelivered ? 'completed' : 'pending'}" data-status="isDelivered"><i class="fas fa-box-open"></i></button></td>
                            <td class="actions"><button class="delete-btn"><i class="fas fa-trash-alt"></i></button></td>`;
                        salesTableBody.appendChild(row);
                    });
                }
            };

            const updateDashboard = () => {
                const totalRevenue = sales.reduce((acc, sale) => acc + (sale.quantity * sale.price), 0);
                totalSalesEl.textContent = sales.length;
                totalRevenueEl.textContent = totalRevenue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            };

            const updateDoughnutChart = () => {
                const salesByProduct = sales.reduce((acc, sale) => {
                    const total = sale.price * sale.quantity;
                    acc[sale.product] = (acc[sale.product] || 0) + total;
                    return acc;
                }, {});
                if (salesDoughnutChart) salesDoughnutChart.destroy();
                salesDoughnutChart = new Chart(doughnutChartCanvas, {
                    type: 'doughnut', data: { labels: Object.keys(salesByProduct), datasets: [{ data: Object.values(salesByProduct), backgroundColor: ['#44CFCB', '#8A2BE2', '#FFD700', '#FF6384'], borderColor: '#1A1A2E', borderWidth: 4 }] },
                    options: { responsive: true, plugins: { legend: { labels: { color: '#F0F0F0' } }, title: { display: true, text: 'Faturamento por Produto', color: '#F0F0F0', font: { size: 16 } } } }
                });
            };

            const updateDailySalesChart = () => {
                const dailyData = [0, 0, 0, 0, 0, 0, 0]; // Dom, Seg, Ter...
                sales.forEach(sale => {
                    const dayOfWeek = new Date(sale.id).getDay();
                    if (dailyChartMetric === 'count') {
                        dailyData[dayOfWeek]++;
                    } else { // revenue
                        dailyData[dayOfWeek] += sale.quantity * sale.price;
                    }
                });

                if (salesBarChart) salesBarChart.destroy();
                
                const chartLabel = dailyChartMetric === 'count' ? 'Nº de Vendas' : 'Faturamento (R$)';
                const yAxisConfig = dailyChartMetric === 'count' 
                    ? { beginAtZero: true, ticks: { color: '#A0A0A0', stepSize: 1 } }
                    : { beginAtZero: true, ticks: { color: '#A0A0A0', callback: (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value) } };

                salesBarChart = new Chart(barChartCanvas, {
                    type: 'bar', data: { labels: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'], datasets: [{ label: chartLabel, data: dailyData, backgroundColor: 'rgba(68, 207, 203, 0.6)', borderColor: 'rgba(68, 207, 203, 1)', borderWidth: 1 }] },
                    options: { responsive: true, scales: { y: yAxisConfig, x: { ticks: { color: '#A0A0A0' } } }, plugins: { legend: { display: false }, title: { display: true, text: 'Análise por Dia da Semana', color: '#F0F0F0', font: { size: 16 } } } }
                });
            };
            
            const handleChartToggle = (e) => {
                dailyChartMetric = e.target.dataset.metric;
                chartToggleButtons.forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                updateDailySalesChart();
            };

            const addSale = (e) => { e.preventDefault(); sales.push({ id: Date.now(), product: document.getElementById('product').value, quantity: parseInt(document.getElementById('quantity').value), price: parseFloat(document.getElementById('price').value), customer: document.getElementById('customer').value, paymentMethod: document.getElementById('payment-method').value, isPaid: false, isDelivered: false }); saveData(); refreshUI(true); saleForm.reset(); };
            
            const handleTableClick = (e) => {
                const target = e.target.closest('button');
                if (!target) return;
                const saleId = parseInt(target.closest('tr').dataset.id);

                if (target.classList.contains('status-icon')) {
                    const statusType = target.dataset.status;
                    const sale = sales.find(s => s.id === saleId);
                    if (sale) { sale[statusType] = !sale[statusType]; saveData(); refreshUI(); }
                }

                if (target.classList.contains('delete-btn')) {
                    Swal.fire({
                        title: 'Você tem certeza?', text: "Esta ação não pode ser desfeita!", icon: 'warning', iconColor: '#FFD700',
                        showCancelButton: true, confirmButtonText: 'Sim, deletar!', cancelButtonText: 'Cancelar',
                        background: '#1A1A2E', color: '#F0F0F0', confirmButtonColor: '#8A2BE2', cancelButtonColor: '#555B69'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            sales = sales.filter(s => s.id !== saleId); saveData(); refreshUI();
                            Swal.fire({ title: 'Deletado!', text: 'A venda foi removida.', icon: 'success', background: '#1A1A2E', color: '#F0F0F0', confirmButtonColor: '#8A2BE2' });
                        }
                    });
                }
            };
            
            const handleFilterClick = (e) => { currentFilter = e.target.dataset.filter; filterButtons.forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); renderSales(); };
            const exportToCSV = () => { if(sales.length === 0){ Swal.fire({title:'Oops!', text:'Não há vendas para exportar.', icon:'info', background:'#1A1A2E', color:'#F0F0F0'}); return; } const h=['id','product','quantity','price','customer','paymentMethod','isPaid','isDelivered']; let c=h.join(',')+'\n'; sales.forEach(s=>{c+=h.map(H=>`"${s[H]}"`).join(',')+'\n'}); const b=new Blob([c],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=`levelup3d_vendas_backup_${new Date().toISOString().split('T')[0]}.csv`; a.click(); };
            const importFromCSV = (e) => { const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=(ev)=>{ const c=ev.target.result; const l=c.split('\n').filter(L=>L.trim()); if(l.length<=1){ Swal.fire('Erro', 'Arquivo CSV vazio ou em formato inválido.', 'error'); return; } Swal.fire({ title: 'Importar Vendas?', text: "Isso irá sobrescrever TODAS as vendas atuais. Esta ação é irreversível.", icon: 'warning', showCancelButton: true, confirmButtonText: 'Sim, importar!', cancelButtonText: 'Cancelar', background: '#1A1A2E', color: '#F0F0F0', confirmButtonColor: '#8A2BE2', cancelButtonColor: '#555B69' }).then(res=>{ if(res.isConfirmed){ try { const h=l[0].split(',').map(H=>H.replace(/"/g,'').trim()); const iS=[]; for(let i=1;i<l.length;i++){const v=l[i].split(',').map(V=>V.replace(/"/g,'').trim());const s={}; h.forEach((H,I)=>{let V=v[I]; if(['id','quantity'].includes(H))V=parseInt(V);if(H==='price')V=parseFloat(V);if(['isPaid','isDelivered'].includes(H))V=V==='true';s[H]=V;}); iS.push(s);} sales=iS; saveData(); refreshUI(); Swal.fire({title:'Sucesso!', text:`${iS.length} vendas foram importadas.`, icon:'success', background:'#1A1A2E', color:'#F0F0F0'}); } catch (error){ Swal.fire('Erro na Importação', 'Ocorreu um problema ao processar o arquivo.', 'error'); } } importInput.value=''; }); }; r.readAsText(f); };

            // Event Listeners
            saleForm.addEventListener('submit', addSale);
            salesTableBody.addEventListener('click', handleTableClick);
            filterButtons.forEach(btn => btn.addEventListener('click', handleFilterClick));
            chartToggleButtons.forEach(btn => btn.addEventListener('click', handleChartToggle));
            exportBtn.addEventListener('click', exportToCSV);
            importInput.addEventListener('change', importFromCSV);
            
            // Renderização Inicial
            refreshUI();
        });
    </script>
</body>
</html>